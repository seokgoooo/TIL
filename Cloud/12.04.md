# 가상화
___
#### 클라우드 엔지니어의 가장 중요한 일은 서비스가 멈추면 안 된다.

#### 가상화 종류
- 하드웨어 지원 가상화 (Hardware-assisted Virtualization)
  - HVM 

##### 하이퍼바이저 타입과 종류
- 타입 1 (실무용)
  - native or bare-metal
    - Citrix XenServer, Linux KVM (AWS가 사용), VMware ESXi Server, MS Hyper-v
    - OS = VMware
- 타입 2 (실습용)
  - hosted
    - VMware Workstation Pro, VMware Workstation Player, VMware Fusion, Linux QEMU, MS Virtual PC


### IP
|차이점|public IP|private IP|
|:--|:--:|:--:|
|IP 제공자|인터넷 서비스 공급자 (ISP)|라우터|
|고유성|인터넷 상에서 유일|하나의 네트워크 상에서 유일|
|공개 여부|내/외부 접근 가능|외부 접근 불가능|
|이유|전 세계에서 유일함|공유기라는 라우터(공인IP) 속의 내부망 안에 갇혀 있기 때문이다|

#### IP를 굳이 두 종류로 나눈 이유
1) IPv4 주소의 낭비를 막고 (전 세계 40억개 밖에 없기 때문)
2) 공인 인터넷을 굳이 사용하지 않아도 되는 단말들에게 어느 망이든 중복 사용 가능한 IP를 주기 위함이다.
    - (공인망에서는 public IP만이 유통) 
   
> Public IP가 있어야 인터넷 이용이 가능하다.
> 그래서 Public IP를 공유하기 위해 공유기를 사용한다.

#### NAT (network address translation)
- NAT를 이용하는 이유 : 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위해서

- Private IP 뿐인 내 컴퓨터가 외부 서비스(8.8.8.8)를 사용하고자 공유기로 나아가면, 공유기는 Private IP 뿐인 내 컴퓨터의 IP를 공유기 자신의 공인 IP로 변환(Translation)하게 된다.
- 즉 공유기를 지나 외부 인터넷으로 나아갈 때에는 공유기의 공인 IP를 가지고 원하는 Destination Address로 향하는 것이다.

#### NAT 네트워크 -> 가상의 공유기 역할. 가상머신끼리 통신 가능하게 가상 IP 할당

#### 클라우드에서 img 라고 하면 os 를 의미한다.

#### vbox vmware 에서 각각의 os를 설치하고 연동해보자
  - spec 설정 
    - 전체 CPU 논리 프로세서에서 20% 는 host에 주고 나머지를 VM이 사용한다. ( 예시: 8core 중에 2core는 host 6core는 vm에 분배하고 1core를 1개의 os에게 부여)
    - 전체 RAM의 20%는 host에 주고 나머지를 VM이 사용한다.
    - 다른 내용은 메모장에 정리

#### 동적할당 VS 고정크기
- 가상머신 환경에서는 *.vdi 파일의 크기에 따라 쓰는 방식의 차이가 있다.
- 동적할당은 쓰는만큼 파일의 크기가 커지고 이미 크기가 커진 후에는 불필요한 용량을 지워도 파일의 크기가 줄어들지 않는 특징이 있다. (실습용)
- 고정크기는 처음부터 파일의 크기를 128GB 부여한다고 설정하면 128GB로 파일 크기가 고정된다. (실무용 / 성능이 더 좋다)
- SSD의 용량이 256G 일지라도 실제 차지하는 용량은 256G 보다 더 적기 때문에 128G 씩 부여할 수 없다.
  - 동적할당을 이용해서 OS마다 128G씩 부여할 수 있다.

- mobaxterm (ssh support 도구)

#### 포트 포워딩 (Port forwarding)
- 외부 IP:Port 와 내부 IP:Port를 연결해주는 기능
- PAT; Port Address Translation
- 중요하다 (host IP - 주로 윈도우10 이나 Docker)
- 라우팅 (Routing) : 출발지에서 목적지까지의 경로를 결정하는 것
- 포워딩 (Forwarding) : 라우터의 입력 포트에서 출력 포트로 packet을 이동시키는 것
> 외부에서 공유기 내의 특정한 장치로 접속하기 위해서는 IP를 알아야한다.
> 그러나 공유기 내부의 IP는 사설 IP로 이루어져 있어 외부에서 IP만으로 특정 장치를 지정할 수 없다.
> 따라서 공유기의 공인 IP로 접속한 후 특정한 PC로 연결되도록 포트 넘버를 공유기에서 정의해주는 작업이 필요하다.
> 이를 포트 포워딩이라 한다.
- ssh, httpd 등 서비스를 추가할 때 마다 포트 포워딩을 해야 한다.
  > 귀찮기 때문에 랜카드를 추가해서 이 과정을 없애보자
  > 추가한 랜카드에 호스트 전용 어댑터를 사용해 내부망을 가리키는 IP를 하나 더 생성한다고 생각해라
  > 그러면 따로따로 포트포워딩을 안해줘도 알아서 가리키는 IP로 포워딩 해주니까?
- 랜카드 2개가 되면 IP도 2개가 된다.

#### 포트는 0 ~ 65535번 까지 존재
- well-known port (0 ~ 1023) (TCP 22(ssh), 80(http), 443(https))
  - 이미 어떤 통신이 해당 포트를 사용할 것인지 정해져 있는 포트 번호
- unknown port (1024 ~ 65535) (TCP 3306(mysql), )

#### 스냅샷은 백업이 아니다
- 백업은 물리적으로 백업 파일을 기존 PC에서 다른 환경으로 보내야 백업이다.
